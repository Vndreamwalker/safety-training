<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đào tạo nhận diện mối nguy</title>

<style>
body {
  font-family: Arial;
  background:#f5f5f5;
  padding:20px
}
h1 { text-align:center }

.video-wrapper {
  position:relative;
  width:800px;
  max-width:100%;
  margin:auto;
  background:#000;
  border:3px solid #333;
}

#player { width:100%; height:450px }

/* lớp bắt click */
#click-layer {
  position:absolute;
  top:0; left:0;
  width:100%; height:100%;
  cursor:crosshair;
  display:none;
}

/* vùng chọn của người học */
.user-select {
  position:absolute;
  width:120px;
  height:120px;
  border:2px solid #007bff;
  background:rgba(0,123,255,.25);
  pointer-events:none;
  display:none;
}

/* mối nguy thật */
.hazard {
  position:absolute;
  border:2px dashed red;
  background:rgba(255,0,0,.25);
  display:none;
}

.hazard.correct {
  border-color:green;
  background:rgba(0,200,0,.35);
}

.info,.result {
  text-align:center;
  margin-top:15px;
  font-size:18px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>Nhận diện mối nguy trong video</h1>

<div class="video-wrapper">
  <div id="player"></div>

  <!-- lớp click -->
  <div id="click-layer"></div>

  <!-- vùng chọn người học -->
  <div id="userSelect" class="user-select"></div>

  <!-- MỐI NGUY THẬT -->
  <div class="hazard" data-id="1"
       style="top:120px; left:100px; width:150px; height:120px;"></div>

  <div class="hazard" data-id="2"
       style="top:240px; left:360px; width:160px; height:130px;"></div>
</div>

<div class="info">
  Lượt chọn: <span id="tries">0</span> / 2
</div>

<div class="result" id="result"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;

const START_TIME = 20;
const STOP_TIME  = 30;
const MAX_TRIES  = 2;
const BOX_SIZE   = 120;

let tries = 0;
let evaluated = false;
let foundHazards = new Set();

const hazards    = document.querySelectorAll('.hazard');
const clickLayer = document.getElementById('click-layer');
const userSelect = document.getElementById('userSelect');

/* YouTube API */
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'fXYMaqxx2sY',
    playerVars: { controls: 1, rel: 0 },
    events: { onReady: onPlayerReady }
  });
}

function onPlayerReady() {
  player.seekTo(START_TIME, true);
  player.playVideo();

  const timer = setInterval(() => {
    if (player.getCurrentTime() >= STOP_TIME) {
      player.pauseVideo();
      clickLayer.style.display = 'block';
      clearInterval(timer);
    }
  }, 200);
}

/* xử lý click đoán */
clickLayer.addEventListener('click', e => {
  if (evaluated || tries >= MAX_TRIES) return;

  tries++;
  document.getElementById('tries').innerText = tries;

  const rect = clickLayer.getBoundingClientRect();

  const x = e.clientX - rect.left - BOX_SIZE / 2;
  const y = e.clientY - rect.top  - BOX_SIZE / 2;

  /* hiển thị vùng chọn */
  userSelect.style.left = x + 'px';
  userSelect.style.top  = y + 'px';
  userSelect.style.display = 'block';

  /* kiểm tra trúng mối nguy */
  hazards.forEach(h => {
hazards.forEach(h => {
  const hx = h.offsetLeft;
  const hy = h.offsetTop;
  const hw = h.offsetWidth;
  const hh = h.offsetHeight;

  if (
    x + BOX_SIZE >= hx &&
    x <= hx + hw &&
    y + BOX_SIZE >= hy &&
    y <= hy + hh
  ) {
    foundHazards.add(h.dataset.id);
  }
});

    if (
      x + BOX_SIZE >= hx &&
      x <= hx + hRect.width &&
      y + BOX_SIZE >= hy &&
      y <= hy + hRect.height
    ) {
      foundHazards.add(h.dataset.id);
    }
  });

  if (tries >= MAX_TRIES) {
    evaluate();
  }
});

/* đánh giá */
function evaluate() {
  evaluated = true;
  clickLayer.style.display = 'none';
  userSelect.style.display = 'none';

  hazards.forEach(h => {
    h.style.display = 'block';
    if (foundHazards.has(h.dataset.id)) {
      h.classList.add('correct');
    }
  });

  const result = document.getElementById('result');

  if (foundHazards.size === hazards.length) {
    result.style.color = 'green';
    result.innerHTML = "✅ ĐÁNH GIÁ ĐÚNG – NGĂN CHẶN TAI NẠN";
    player.stopVideo();
  } else {
    result.style.color = 'red';
    result.innerHTML = "❌ ĐÁNH GIÁ CHƯA ĐỦ – TAI NẠN XẢY RA";
    player.playVideo();
  }
}
</script>

</body>
</html>

