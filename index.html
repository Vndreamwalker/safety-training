<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Nhận diện mối nguy (Hazard identification)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:10px;
}

h1 {
  text-align:center;
  font-size:20px;
}

.video-wrapper {
  position:relative;
  width:100%;
  max-width:900px;
  margin:auto;
  background:#000;
  border:3px solid #333;
  aspect-ratio:16/9;
}

#player,
#click-layer {
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
}

#click-layer {
  z-index:6;
  cursor:crosshair;
  display:none;
}

/* VÙNG CHỌN – HIỂN THỊ SẴN */
.user-select {
  position:absolute;
  width:25%;
  aspect-ratio:1/1;
  border:3px solid #007bff;
  background:rgba(0,123,255,.2);
  pointer-events:none;
  z-index:7;
  left:37.5%;
  top:37.5%;
}

/* mối nguy */
.hazard {
  position:absolute;
  border:3px dashed red;
  background:rgba(255,0,0,.25);
  z-index:5;
}

.hazard.correct {
  border-color:green;
  background:rgba(0,200,0,.35);
}

.info,.result {
  text-align:center;
  margin-top:12px;
  font-size:16px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1> Video sẽ tạm dừng để người chơi xác định các mối nguy nhằm cứu nhân vật. Nếu không phát hiện đủ mối nguy, tai nạn sẽ tiếp diễn. 
  The video pauses for players to spot hazards and save the character. If not enough hazards are identified, the accident will continue. </h1>

<div class="video-wrapper">
  <div id="player"></div>
  <div id="click-layer"></div>

  <!-- VÙNG CHỌN HIỂN THỊ NGAY -->
  <div id="userSelect" class="user-select"></div>

  <!-- 7 MỐI NGUY -->
  <div class="hazard" data-id="1" data-x="0.12" data-y="0.30" data-w="0.15" data-h="0.35"></div>
  <div class="hazard" data-id="2" data-x="0.40" data-y="0.18" data-w="0.12" data-h="0.25"></div>
  <div class="hazard" data-id="3" data-x="0.37" data-y="0.50" data-w="0.20" data-h="0.18"></div>
  <div class="hazard" data-id="4" data-x="0.50" data-y="0.58" data-w="0.08" data-h="0.15"></div>
  <div class="hazard" data-id="5" data-x="0.56" data-y="0.25" data-w="0.08" data-h="0.45"></div>
  <div class="hazard" data-id="6" data-x="0.63" data-y="0.45" data-w="0.22" data-h="0.30"></div>
  <div class="hazard" data-id="7" data-x="0.28" data-y="0.40" data-w="0.12" data-h="0.22"></div>
</div>

<div class="info">
  Lượt chọn (turn): <span id="tries">0</span> / 7
</div>

<div class="result" id="result"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;

const START_TIME = 20;
const STOP_TIME  = 30;

let tries = 0;
let evaluated = false;

const hazards    = document.querySelectorAll('.hazard');
const MAX_TRIES  = hazards.length;

const clickLayer = document.getElementById('click-layer');
const userSelect = document.getElementById('userSelect');

/* RENDER THEO TỶ LỆ */
function renderHazards() {
  const w = clickLayer.clientWidth;
  const h = clickLayer.clientHeight;

  hazards.forEach(hz => {
    hz.style.left   = hz.dataset.x * w + 'px';
    hz.style.top    = hz.dataset.y * h + 'px';
    hz.style.width  = hz.dataset.w * w + 'px';
    hz.style.height = hz.dataset.h * h + 'px';
  });
}

window.addEventListener('resize', renderHazards);

/* YOUTUBE */
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'fXYMaqxx2sY',
    playerVars: { controls: 1, rel: 0 },
    events: { onReady: onPlayerReady }
  });
}

function onPlayerReady() {
  renderHazards();
  player.seekTo(START_TIME, true);
  player.playVideo();

  const timer = setInterval(() => {
    if (player.getCurrentTime() >= STOP_TIME) {
      player.pauseVideo();
      clickLayer.style.display = 'block';
      clearInterval(timer);
    }
  }, 200);
}

/* CLICK DI CHUYỂN VÙNG CHỌN */
clickLayer.addEventListener('pointerdown', e => {
  if (evaluated || tries >= MAX_TRIES) return;

  tries++;
  document.getElementById('tries').innerText = tries;

  const rect = clickLayer.getBoundingClientRect();
  const x = (e.clientX - rect.left) / rect.width;
  const y = (e.clientY - rect.top) / rect.height;

  userSelect.style.left = (x * 100 - 12.5) + '%';
  userSelect.style.top  = (y * 100 - 12.5) + '%';

  hazards.forEach(hz => {
    const hx = +hz.dataset.x;
    const hy = +hz.dataset.y;
    const hw = +hz.dataset.w;
    const hh = +hz.dataset.h;

    if (x >= hx && x <= hx + hw && y >= hy && y <= hy + hh) {
      hz.classList.add('correct');
    }
  });

  if (tries >= MAX_TRIES) evaluate();
});

/* ĐÁNH GIÁ */
function evaluate() {
  evaluated = true;
  clickLayer.style.display = 'none';

  const correct = document.querySelectorAll('.hazard.correct').length;
  const result = document.getElementById('result');

  result.style.color = correct === hazards.length ? 'green' : 'red';
  result.innerHTML =
    correct === hazards.length
      ? "✅ PHÁT HIỆN ĐỦ 7 MỐI NGUY"
      : `❌ PHÁT HIỆN ${correct}/7 MỐI NGUY`;
}
</script>

</body>
</html>

