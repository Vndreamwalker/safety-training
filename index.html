<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đào tạo nhận diện mối nguy</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f5f5f5;
    padding: 20px;
  }

  h1 {
    text-align: center;
  }

  .video-wrapper {
    position: relative;
    width: 800px;
    max-width: 100%;
    margin: auto;
    border: 3px solid #333;
    background: #000;
  }

  #player {
    width: 100%;
    height: 450px;
  }

  .hazard {
    position: absolute;
    border: 2px dashed red;
    background: rgba(255, 0, 0, 0.2);
    cursor: pointer;
    display: none;
  }

  .hazard.clicked {
    border-color: green;
    background: rgba(0, 200, 0, 0.35);
  }

  .info, .result {
    text-align: center;
    margin-top: 15px;
    font-size: 18px;
    font-weight: bold;
  }
</style>
</head>

<body>

<h1>Nhận diện mối nguy trong video</h1>

<div class="video-wrapper">
  <div id="player"></div>

  <!-- CLICK ZONE -->
  <div class="hazard"
       style="top:120px; left:100px; width:150px; height:120px;"></div>

  <div class="hazard"
       style="top:240px; left:350px; width:160px; height:130px;"></div>

</div>

<div class="info">
  Mối nguy đã phát hiện: <span id="count">0</span> / <span id="total">2</span>
</div>

<div class="result" id="result"></div>

<!-- YouTube API -->
<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
const START_TIME = 20; // giây
const STOP_TIME = 30;

const hazards = document.querySelectorAll('.hazard');
const totalHazards = hazards.length;
let found = 0;
let evaluated = false;

document.getElementById('total').innerText = totalHazards;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'fXYMaqxx2sY',
    playerVars: {
      start: 0,
      controls: 1
    },
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
}

function onPlayerReady() {
  player.playVideo();
}

function onPlayerStateChange(event) {
  if (event.data === YT.PlayerState.PLAYING) {
    checkTime();
  }
}

function checkTime() {
  const interval = setInterval(() => {
    if (!player || evaluated) return;

    const currentTime = player.getCurrentTime();

    if (currentTime >= START_TIME && currentTime < STOP_TIME) {
      player.pauseVideo();
      showHazards();
      clearInterval(interval);
    }
  }, 300);
}

function showHazards() {
  hazards.forEach(h => h.style.display = 'block');
}

hazards.forEach(hazard => {
  hazard.addEventListener('click', function () {
    if (!this.classList.contains('clicked')) {
      this.classList.add('clicked');
      found++;
      document.getElementById('count').innerText = found;
    }
  });
});

function evaluateResult() {
  evaluated = true;
  const result = document.getElementById('result');

  if (found === totalHazards) {
    result.style.color = 'green';
    result.innerHTML = "✅ ĐÁNH GIÁ ĐÚNG – NGĂN CHẶN ĐƯỢC TAI NẠN";
    player.stopVideo();
  } else {
    result.style.color = 'red';
    result.innerHTML = "❌ ĐÁNH GIÁ CHƯA ĐỦ – TAI NẠN XẢY RA";
    hazards.forEach(h => h.style.display = 'none');
    player.playVideo();
  }
}

setInterval(() => {
  if (!evaluated && found === totalHazards) {
    evaluateResult();
  }
}, 500);

</script>

</body>
</html>