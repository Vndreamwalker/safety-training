<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ƒê√†o t·∫°o nh·∫≠n di·ªán m·ªëi nguy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f5f5f5;
  padding:10px;
}

h1 {
  text-align:center;
  font-size:20px;
}

.video-wrapper {
  position:relative;
  width:100%;
  max-width:800px;
  margin:auto;
  background:#000;
  border:3px solid #333;
  aspect-ratio:16/9;
  overflow:hidden;
}

/* l·ªõp nh·∫•p nh√°y */
.flash {
  position:absolute;
  top:0; left:0;
  width:100%;
  height:100%;
  z-index:20;
  display:none;
}

.flash.success {
  background:rgba(0,200,0,.35);
}

.flash.fail {
  background:rgba(255,0,0,.35);
}

#player,
#click-layer {
  position:absolute;
  top:0; left:0;
  width:100%;
  height:100%;
}

/* l·ªõp b·∫Øt click */
#click-layer {
  z-index:5;
  cursor:crosshair;
  display:none;
}

/* v√πng ch·ªçn */
.user-select {
  position:absolute;
  width:25%;
  aspect-ratio:1/1;
  border:3px solid #007bff;
  background:rgba(0,123,255,.2);
  pointer-events:none;
  z-index:6;
  display:none;
}

/* m·ªëi nguy */
.hazard {
  position:absolute;
  border:3px dashed red;
  background:rgba(255,0,0,.25);
  display:none;
  z-index:4;
}

.hazard.correct {
  border-color:green;
  background:rgba(0,200,0,.35);
}

/* th√¥ng b√°o */
.message {
  position:absolute;
  bottom:10%;
  left:50%;
  transform:translateX(-50%);
  padding:12px 18px;
  font-size:18px;
  font-weight:bold;
  color:#fff;
  background:rgba(0,0,0,.7);
  border-radius:8px;
  z-index:30;
  display:none;
  text-align:center;
}

.info {
  text-align:center;
  margin-top:12px;
  font-size:16px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>Nh·∫≠n di·ªán m·ªëi nguy trong video</h1>

<div class="video-wrapper">
  <div id="player"></div>
  <div id="click-layer"></div>
  <div id="userSelect" class="user-select"></div>

  <div id="flash" class="flash"></div>
  <div id="message" class="message"></div>

  <!-- M·ªêI NGUY (T·ª∂ L·ªÜ %) -->
  <div class="hazard" data-id="1"
       data-x="0.12" data-y="0.26" data-w="0.18" data-h="0.26"></div>

  <div class="hazard" data-id="2"
       data-x="0.45" data-y="0.53" data-w="0.2" data-h="0.28"></div>
</div>

<div class="info">
  L∆∞·ª£t ch·ªçn: <span id="tries">0</span> / 2
</div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;

const START_TIME = 20;
const STOP_TIME  = 30;
const MAX_TRIES  = 2;

let tries = 0;
let evaluated = false;

const hazards    = document.querySelectorAll('.hazard');
const clickLayer = document.getElementById('click-layer');
const userSelect = document.getElementById('userSelect');
const flashBox   = document.getElementById('flash');
const messageBox = document.getElementById('message');

/* render hazard theo % */
function renderHazards() {
  const w = clickLayer.clientWidth;
  const h = clickLayer.clientHeight;

  hazards.forEach(hz => {
    hz.style.left   = hz.dataset.x * w + 'px';
    hz.style.top    = hz.dataset.y * h + 'px';
    hz.style.width  = hz.dataset.w * w + 'px';
    hz.style.height = hz.dataset.h * h + 'px';
  });
}
window.addEventListener('resize', renderHazards);

/* YouTube */
function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'fXYMaqxx2sY',
    playerVars: { controls: 1, rel: 0 },
    events: { onReady: onPlayerReady }
  });
}

function onPlayerReady() {
  renderHazards();
  player.seekTo(START_TIME, true);
  player.playVideo();

  const timer = setInterval(() => {
    if (player.getCurrentTime() >= STOP_TIME) {
      player.pauseVideo();
      clickLayer.style.display = 'block';
      clearInterval(timer);
    }
  }, 200);
}

/* hi·ªáu ·ª©ng nh·∫•p nh√°y */
function flash(type, text) {
  flashBox.className = 'flash ' + type;
  messageBox.innerText = text;

  flashBox.style.display = 'block';
  messageBox.style.display = 'block';

  setTimeout(() => {
    flashBox.style.display = 'none';
    messageBox.style.display = 'none';
  }, 1500);
}

/* click */
clickLayer.addEventListener('pointerdown', e => {
  if (evaluated || tries >= MAX_TRIES) return;

  tries++;
  document.getElementById('tries').innerText = tries;

  const rect = clickLayer.getBoundingClientRect();
  const x = (e.clientX - rect.left) / rect.width;
  const y = (e.clientY - rect.top) / rect.height;

  userSelect.style.left = (x * 100 - 12.5) + '%';
  userSelect.style.top  = (y * 100 - 12.5) + '%';
  userSelect.style.display = 'block';

  let hit = false;

  hazards.forEach(hz => {
    const hx = +hz.dataset.x;
    const hy = +hz.dataset.y;
    const hw = +hz.dataset.w;
    const hh = +hz.dataset.h;

    if (x >= hx && x <= hx + hw && y >= hy && y <= hy + hh) {
      hit = true;
      hz.classList.add('correct');
    }
  });

  if (hit) {
    setTimeout(() => userSelect.style.display = 'none', 300);
    evaluated = true;
    clickLayer.style.display = 'none';
    hazards.forEach(h => h.style.display = 'block');
    flash('success', 'üéâ Ch√∫c m·ª´ng b·∫°n ƒë√£ d·ª´ng ƒë∆∞·ª£c tai n·∫°n');
    player.stopVideo();
  } else {
    flash('fail', '‚ö†Ô∏è Tai n·∫°n s·∫Øp x·∫£y ra');
  }
});
</script>

</body>
</html>
