<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Đào tạo nhận diện mối nguy</title>

<style>
  body { font-family: Arial; background:#f5f5f5; padding:20px }
  h1 { text-align:center }
  .video-wrapper {
    position:relative;
    width:800px; max-width:100%;
    margin:auto; background:#000; border:3px solid #333;
  }
  #player { width:100%; height:450px }
  .hazard {
    position:absolute;
    border:2px dashed red;
    background:rgba(255,0,0,.25);
    cursor:pointer;
    display:none;
  }
  .hazard.clicked {
    border-color:green;
    background:rgba(0,200,0,.35);
  }
  .info,.result { text-align:center; margin-top:15px; font-size:18px; font-weight:bold }
</style>
</head>

<body>

<h1>Nhận diện mối nguy trong video</h1>

<div class="video-wrapper">
  <div id="player"></div>

  <!-- CLICK ZONE -->
  <div class="hazard" style="top:120px; left:100px; width:150px; height:120px;"></div>
  <div class="hazard" style="top:240px; left:360px; width:160px; height:130px;"></div>
</div>

<div class="info">
  Mối nguy đã phát hiện: <span id="count">0</span> / <span id="total">2</span>
</div>

<div class="result" id="result"></div>

<script src="https://www.youtube.com/iframe_api"></script>

<script>
let player;
const START_TIME = 20;
const STOP_TIME  = 30;

const hazards = document.querySelectorAll('.hazard');
const totalHazards = hazards.length;
let found = 0;
let evaluated = false;
let timeWatcher = null;

document.getElementById('total').innerText = totalHazards;

function onYouTubeIframeAPIReady() {
  player = new YT.Player('player', {
    videoId: 'fXYMaqxx2sY',
    playerVars: {
      controls: 1,
      rel: 0
    },
    events: {
      onReady: onPlayerReady
    }
  });
}

function onPlayerReady() {
  player.seekTo(START_TIME, true);
  player.playVideo();

  timeWatcher = setInterval(() => {
    const t = player.getCurrentTime();

    if (t >= STOP_TIME && !evaluated) {
      player.pauseVideo();
      showHazards();
      clearInterval(timeWatcher);
    }
  }, 200);
}

function showHazards() {
  hazards.forEach(h => h.style.display = 'block');
}

hazards.forEach(h => {
  h.addEventListener('click', () => {
    if (!h.classList.contains('clicked')) {
      h.classList.add('clicked');
      found++;
      document.getElementById('count').innerText = found;
      if (found === totalHazards) evaluate(true);
    }
  });
});

function evaluate(success) {
  evaluated = true;
  const result = document.getElementById('result');

  if (success) {
    result.style.color = 'green';
    result.innerHTML = "✅ ĐÁNH GIÁ ĐÚNG – NGĂN CHẶN ĐƯỢC TAI NẠN";
    player.stopVideo();
  } else {
    result.style.color = 'red';
    result.innerHTML = "❌ ĐÁNH GIÁ CHƯA ĐỦ – TAI NẠN XẢY RA";
    hazards.forEach(h => h.style.display = 'none');
    player.playVideo();
  }
}
</script>

</body>
</html>
